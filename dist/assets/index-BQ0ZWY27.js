import{r as e,a as t}from"./vendor-CZFfU7IE.js";import{u as s,L as r,M as a,T as n,C as l,a as o,b as i}from"./leaflet-BBHYNY-y.js";import{P as c,M as d,N as m,R as u,a as x,S as g,L as h,C as p,b,c as f,d as y,e as v,f as j,E as w,U as N,D as k,F as L,g as C,h as S,i as E,T as $,j as T,X as O,k as M,l as P,m as A}from"./icons-D50UlVTl.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var F={exports:{}},D={},R=e,_=Symbol.for("react.element"),z=Symbol.for("react.fragment"),I=Object.prototype.hasOwnProperty,U=R.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};function B(e,t,s){var r,a={},n=null,l=null;for(r in void 0!==s&&(n=""+s),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(l=t.ref),t)I.call(t,r)&&!G.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:_,type:e,key:n,ref:l,props:a,_owner:U.current}}D.Fragment=z,D.jsx=B,D.jsxs=B,F.exports=D;var W,H=F.exports,V=t;W=V.createRoot,V.hydrateRoot;const J=({onZoomIn:e,onZoomOut:t,onResetView:s,onToggleGPS:r,isGPSActive:a,onStartMeasurement:n,isMeasuring:l,measurementType:o})=>{const i=window.innerWidth<768,h=i?"w-11 h-11":"w-12 h-12",p=i?"h-4 w-4":"h-5 w-5";return H.jsxs("div",{className:`absolute ${i?"top-2 right-2":"top-4 right-4"} z-[1000] flex flex-col space-y-2`,children:[H.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-xl shadow-lg overflow-hidden",children:[H.jsx("button",{onClick:e,className:`block ${h} flex items-center justify-center hover:bg-gray-100 transition-colors duration-200 border-b border-gray-200 active:bg-gray-200`,children:H.jsx(c,{className:`${p} text-gray-700`})}),H.jsx("button",{onClick:t,className:`block ${h} flex items-center justify-center hover:bg-gray-100 transition-colors duration-200 active:bg-gray-200`,children:H.jsx(d,{className:`${p} text-gray-700`})})]}),H.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-xl shadow-lg overflow-hidden",children:[H.jsx("button",{onClick:r,className:`block ${h} flex items-center justify-center transition-all duration-200 border-b border-gray-200 active:scale-95 ${a?"bg-blue-500 text-white hover:bg-blue-600":"hover:bg-gray-100 text-gray-700 active:bg-gray-200"}`,title:"Toggle GPS Tracking",children:H.jsx(m,{className:`${p} ${a?"animate-pulse":""}`})}),H.jsx("button",{onClick:s,className:`block ${h} flex items-center justify-center hover:bg-gray-100 transition-colors duration-200 text-gray-700 active:bg-gray-200`,title:"Reset View",children:H.jsx(u,{className:p})})]}),H.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-xl shadow-lg overflow-hidden",children:[H.jsx("button",{onClick:()=>n("distance"),className:`block ${h} flex items-center justify-center transition-all duration-200 border-b border-gray-200 active:scale-95 ${l&&"distance"===o?"bg-orange-500 text-white hover:bg-orange-600":"hover:bg-gray-100 text-gray-700 active:bg-gray-200"}`,title:"Measure Distance",children:H.jsx(x,{className:p})}),H.jsx("button",{onClick:()=>n("area"),className:`block ${h} flex items-center justify-center transition-all duration-200 active:scale-95 ${l&&"area"===o?"bg-green-500 text-white hover:bg-green-600":"hover:bg-gray-100 text-gray-700 active:bg-gray-200"}`,title:"Measure Area",children:H.jsx(g,{className:p})})]})]})},Z=({selectedLayers:t,onLayerChange:s})=>{const[r,a]=e.useState(!0),n=window.innerWidth<768;return H.jsxs("div",{className:"bg-white/95 backdrop-blur-md rounded-xl shadow-lg overflow-hidden",children:[H.jsx("div",{className:`p-3 border-b border-gray-200 ${n?"cursor-pointer hover:bg-gray-50":""} transition-colors duration-200`,onClick:()=>n&&a(!r),children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx(h,{className:(n?"h-4 w-4":"h-5 w-5")+" text-gray-700"}),H.jsx("h3",{className:"font-semibold text-gray-800 "+(n?"text-sm":""),children:"Map Layers"})]}),n&&H.jsx("div",{className:"transform transition-transform duration-200 "+(r?"rotate-180":""),children:H.jsx(p,{className:"w-4 h-4 text-gray-500"})})]})}),(!n||r)&&H.jsxs("div",{className:"p-3 space-y-2 "+(n?"p-4":""),children:[[{id:"satellite",name:"Google Satellite",color:"bg-green-500"},{id:"hybrid",name:"Google Hybrid",color:"bg-blue-500"},{id:"openstreet",name:"OpenStreetMap",color:"bg-orange-500"}].map(e=>H.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-gray-50 p-2 rounded-lg transition-colors duration-200 "+(n?"min-h-[44px]":""),children:[H.jsxs("div",{className:"relative",children:[H.jsx("input",{type:"checkbox",checked:t.includes(e.id),onChange:()=>{return r=e.id,void(t.includes(r)?t.length>1&&s(t.filter(e=>e!==r)):s([...t,r]));var r},className:"sr-only"}),H.jsx("div",{className:`${n?"w-5 h-5":"w-4 h-4"} rounded border-2 border-gray-300 flex items-center justify-center ${t.includes(e.id)?e.color:"bg-white"}`,children:t.includes(e.id)&&H.jsx("svg",{className:(n?"w-4 h-4":"w-3 h-3")+" text-white",fill:"currentColor",viewBox:"0 0 20 20",children:H.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),H.jsx("span",{className:"font-medium text-gray-700 text-sm",children:e.name})]},e.id)),H.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:H.jsx("p",{className:"text-gray-500 text-xs",children:"Select multiple layers to overlay them"})})]})]})},Y=({rotation:e})=>H.jsxs("div",{className:"flex flex-col items-center",children:[H.jsx("div",{className:"bg-white/95 backdrop-blur-md rounded-full shadow-lg p-4 w-20 h-20 flex items-center justify-center",children:H.jsxs("div",{className:"relative",children:[H.jsx(b,{className:"h-10 w-10 text-gray-700",style:{transform:`rotate(${-e}deg)`}}),H.jsx("div",{className:"absolute -top-1 left-1/2 transform -translate-x-1/2",children:H.jsx("div",{className:"w-1 h-3 bg-red-500 rounded-full"})})]})}),H.jsx("div",{className:"text-center mt-2",children:H.jsxs("span",{className:"text-xs font-mono bg-white/95 backdrop-blur-md px-2 py-1 rounded text-gray-700",children:[Math.round(e),"°"]})})]}),K=({position:e,isTracking:t})=>{const s=window.innerWidth<768;return H.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-xl shadow-lg p-3 "+(s?"min-w-[200px] text-sm":"min-w-[250px]"),children:[H.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[H.jsx(f,{className:`${s?"h-4 w-4":"h-5 w-5"} ${t?"text-green-500 animate-pulse":"text-gray-400"}`}),H.jsx("h3",{className:"font-semibold text-gray-800 "+(s?"text-sm":""),children:"GPS Status"})]}),t?e?H.jsxs("div",{className:"space-y-2",children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx(y,{className:(s?"h-3 w-3":"h-4 w-4")+" text-blue-500"}),H.jsx("span",{className:"text-gray-700 "+(s?"text-xs":"text-sm"),children:"Position Found"})]}),H.jsxs("div",{className:"font-mono space-y-1 text-xs",children:[H.jsxs("div",{children:["Lat: ",e.lat.toFixed(6)]}),H.jsxs("div",{children:["Lng: ",e.lng.toFixed(6)]}),H.jsxs("div",{children:["Accuracy: ±",Math.round(e.accuracy),"m"]}),null!==e.heading&&H.jsxs("div",{children:["Heading: ",Math.round(e.heading),"°"]})]})]}):H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("div",{className:"animate-spin rounded-full border-2 border-blue-500 border-t-transparent "+(s?"h-3 w-3":"h-4 w-4")}),H.jsx("span",{className:"text-gray-600 "+(s?"text-xs":"text-sm"),children:"Searching for GPS..."})]}):H.jsx("div",{className:"text-gray-500 "+(s?"text-xs":"text-sm"),children:"GPS tracking disabled"})]})},X=({drawingMode:t,onDrawingComplete:a,onFeatureDrawn:n,onFeatureClick:l,onFeatureDoubleClick:o,drawnFeatures:i})=>{const c=s();return e.useEffect(()=>{if(!c||"none"===t)return;let e=!1,s=null,d=null,m=[],u=[],x=[],g=[],h=0,p=null,b=null;const f=(e="#3b82f6")=>r.divIcon({className:"custom-drawing-marker",html:`<div class="w-3 h-3 bg-white border-2 rounded-full shadow-lg" style="border-color: ${e}"></div>`,iconSize:[12,12],iconAnchor:[6,6]}),y=(e,t="#3b82f6")=>{const s=r.marker(e,{icon:f(t)}).addTo(c);return x.push(s),s},v=()=>{x.forEach(e=>c.removeLayer(e)),x=[]},j=()=>{p&&c.hasLayer(p)&&(c.removeLayer(p),p=null),b&&c.hasLayer(b)&&(c.removeLayer(b),b=null)},w=(e,t,s)=>{const a=t.lat-e.lat,n=t.lng-e.lng,l=s.lat-e.lat,o=s.lng-e.lng,i=a*a+n*n;if(0===i)return[e,t,s,e];const c=(a*l+n*o)/i,d=e.lat+c*a,m=e.lng+c*n,u=s.lat-d,x=s.lng-m,g=e;return[g,t,r.latLng(t.lat+u,t.lng+x),r.latLng(e.lat+u,e.lng+x),g]},N=(e,t)=>{const s=e.properties.attributes?Object.keys(e.properties.attributes).length:0,r=document.createElement("div");r.className="p-3 min-w-[250px]";const a=document.createElement("div");if(a.innerHTML=t,r.appendChild(a),s>0){const t=document.createElement("div");t.className="mt-3 pt-3 border-t border-gray-200";const a=document.createElement("div");a.className="font-semibold text-gray-700 mb-2 flex items-center justify-between",a.innerHTML=`\n          <span>Custom Attributes</span>\n          <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs">\n            ${s}\n          </span>\n        `,t.appendChild(a);const n=document.createElement("div");n.className="space-y-1 text-sm",Object.entries(e.properties.attributes).forEach(([e,t])=>{const s=document.createElement("div");s.className="flex justify-between items-center py-1 px-2 bg-gray-50 rounded",s.innerHTML=`\n            <span class="font-medium text-gray-700">${e}:</span>\n            <span class="text-gray-600 ml-2">${t}</span>\n          `,n.appendChild(s)}),t.appendChild(n),r.appendChild(t)}const n=document.createElement("div");n.className="mt-3 pt-3 border-t border-gray-200",r.appendChild(n);const l=document.createElement("button");l.className="w-full bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center justify-center space-x-2",l.innerHTML=`\n        <span>📝</span>\n        <span>${s>0?`Edit Attributes (${s})`:"Add Attributes"}</span>\n      `,l.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),console.log("Attribute button clicked for feature:",e.id),o(e)}),n.appendChild(l);const i=document.createElement("p");return i.className="text-xs text-gray-500 mt-2 text-center",i.textContent="Click to add or edit feature attributes",n.appendChild(i),r},k=(e,s,a,n={})=>{const o={id:Date.now().toString()+Math.random().toString(36).substr(2,9),type:s,layer:e,coordinates:a,properties:{...n,timestamp:Date.now(),created:(new Date).toLocaleString(),attributes:{}},timestamp:Date.now()};return e._featureData=o,e._isDrawnFeature=!0,e.on("click",e=>{if(console.log("Layer clicked:",o.id,"Mode:",t),r.DomEvent.stopPropagation(e),r.DomEvent.preventDefault(e),"erase"===t)return console.log("Triggering erase for feature:",o.id),l(o),!1},{passive:!1}),e.on("mouseover",s=>{if("erase"===t){if(e instanceof r.Marker){const t=e.getElement();t&&(t.style.filter="hue-rotate(0deg) saturate(2) brightness(1.2)",t.style.transform="scale(1.5)",t.style.transition="all 0.2s ease",t.style.zIndex="10000")}else e.setStyle({color:"#ef4444",fillColor:"#ef4444",weight:4,opacity:1,fillOpacity:.6});c.getContainer().style.cursor="pointer"}}),e.on("mouseout",()=>{if("erase"===t){if(e instanceof r.Marker){const t=e.getElement();t&&(t.style.filter="",t.style.transform="",t.style.zIndex="")}else{const t=L(s);e.setStyle(t)}c.getContainer().style.cursor="crosshair"}}),o},L=e=>({polyline:{color:"#3b82f6",weight:3,opacity:.8},polygon:{color:"#10b981",weight:2,fillOpacity:.2,fillColor:"#10b981",opacity:.8},rectangle:{color:"#f59e0b",weight:2,fillOpacity:.2,fillColor:"#f59e0b",opacity:.8},circle:{color:"#8b5cf6",weight:2,fillOpacity:.2,fillColor:"#8b5cf6",opacity:.8},marker:{}}[e]||{}),C=a=>{if(console.log("Map clicked, mode:",t),"erase"!==t){if("marker"===t){const e=r.marker(a.latlng,{icon:r.divIcon({className:"custom-field-marker",html:'<div class="w-6 h-6 bg-red-500 rounded-full border-2 border-white shadow-lg flex items-center justify-center"><div class="w-2 h-2 bg-white rounded-full"></div></div>',iconSize:[24,24],iconAnchor:[12,12]})}).addTo(c),t=k(e,"marker",[[a.latlng.lng,a.latlng.lat]],{lat:a.latlng.lat,lng:a.latlng.lng}),s=`\n          <div class="font-semibold text-red-600 mb-2">📍 Field Marker</div>\n          <div class="text-sm space-y-1">\n            <div><strong>Latitude:</strong> ${a.latlng.lat.toFixed(6)}</div>\n            <div><strong>Longitude:</strong> ${a.latlng.lng.toFixed(6)}</div>\n            <div class="text-gray-500 text-xs mt-2">\n              Created: ${(new Date).toLocaleString()}\n            </div>\n          </div>\n        `;return e.bindPopup(N(t,s)),void n(t)}if("polyline"!==t){if("polygon"===t)return e?(m.push(a.latlng),y(a.latlng,"#10b981")):(e=!0,m=[a.latlng],y(a.latlng,"#10b981")),void(m.length>=2&&(s&&c.removeLayer(s),s=r.polygon(m,{color:"#10b981",weight:2,fillOpacity:.2,fillColor:"#10b981",opacity:.8}).addTo(c)));if("rectangle"!==t)"circle"!==t||e||(e=!0,d=a.latlng,y(a.latlng,"#8b5cf6"));else if(0===h)g=[a.latlng],h=1,e=!0,y(a.latlng,"#f59e0b"),console.log("Rectangle: First point set");else if(1===h)g.push(a.latlng),h=2,y(a.latlng,"#f59e0b"),j(),p=r.polyline(g,{color:"#f59e0b",weight:3,opacity:.8,dashArray:"5, 5"}).addTo(c),console.log("Rectangle: Second point set, waiting for third point");else if(2===h){g.push(a.latlng);const t=w(g[0],g[1],g[2]);j(),v(),s=r.polygon(t,{color:"#f59e0b",weight:2,fillOpacity:.2,fillColor:"#f59e0b",opacity:.8}).addTo(c);const l=s.getBounds(),o=P(l),i=k(s,"rectangle",[t.map(e=>[e.lng,e.lat])],{area:o,method:"three-point",basePoints:g.length}),d=`\n            <div class="font-semibold text-yellow-600 mb-2">⬜ Rectangle</div>\n            <div class="text-sm">\n              <div><strong>Area:</strong> ${o.toFixed(2)} m²</div>\n              <div><strong>Method:</strong> Three-point construction</div>\n              <div class="text-gray-500 text-xs mt-2">\n                Created: ${(new Date).toLocaleString()}\n              </div>\n            </div>\n          `;s.bindPopup(N(i,d)),n(i),h=0,g=[],e=!1,console.log("Rectangle: Completed, ready for next rectangle")}}else e?(u.push(a.latlng),y(a.latlng,"#3b82f6"),s&&s.setLatLngs(u)):(e=!0,u=[a.latlng],y(a.latlng,"#3b82f6"),s=r.polyline(u,{color:"#3b82f6",weight:3,opacity:.8}).addTo(c))}else{console.log("In erase mode, checking for features...");let e=!1;for(const t of i){if(!t.layer||!c.hasLayer(t.layer))continue;let s=!1;if(t.layer instanceof r.Marker){const e=t.layer.getLatLng();s=a.latlng.distanceTo(e)<50}else if(t.layer instanceof r.Circle){const e=t.layer.getLatLng(),r=t.layer.getRadius();s=a.latlng.distanceTo(e)<=r}else if(t.layer instanceof r.Rectangle){s=t.layer.getBounds().contains(a.latlng)}else if(t.layer instanceof r.Polygon){t.layer.getBounds().contains(a.latlng)&&(s=!0)}else if(t.layer instanceof r.Polyline){const e=t.layer.getLatLngs();for(let t=0;t<e.length-1;t++){if(r.LineUtil.pointToSegmentDistance(c.latLngToLayerPoint(a.latlng),c.latLngToLayerPoint(e[t]),c.latLngToLayerPoint(e[t+1]))<20){s=!0;break}}}if(s){console.log("Found feature to delete:",t.id),l(t),e=!0;break}}if(!e){console.log("No feature found at click location");const e=r.circleMarker(a.latlng,{radius:12,color:"#ef4444",fillColor:"#ef4444",fillOpacity:.3,weight:2}).addTo(c);setTimeout(()=>{c.hasLayer(e)&&c.removeLayer(e)},800)}}},S=a=>{if("rectangle"!==t||2!==h||2!==g.length){if(e&&d&&"polyline"!==t&&"polygon"!==t&&"erase"!==t&&"rectangle"!==t&&(s&&c.removeLayer(s),"circle"===t)){const e=d.distanceTo(a.latlng);s=r.circle(d,{radius:e,color:"#8b5cf6",weight:2,fillOpacity:.2,fillColor:"#8b5cf6",opacity:.8}).addTo(c)}}else{j(),p=r.polyline(g,{color:"#f59e0b",weight:3,opacity:.8,dashArray:"5, 5"}).addTo(c);const e=w(g[0],g[1],a.latlng);b=r.polygon(e,{color:"#f59e0b",weight:2,fillOpacity:.1,fillColor:"#f59e0b",opacity:.6,dashArray:"5, 5"}).addTo(c)}},E=r=>{if(r.originalEvent.preventDefault(),"polyline"===t&&e&&u.length>=2){if(s){const e=O(u),t=k(s,"polyline",u.map(e=>[e.lng,e.lat]),{distance:e,points:u.length}),r=`\n            <div class="font-semibold text-blue-600 mb-2">📏 Polyline</div>\n            <div class="text-sm">\n              <div><strong>Points:</strong> ${u.length}</div>\n              <div><strong>Distance:</strong> ${e.toFixed(2)} m</div>\n              <div class="text-gray-500 text-xs mt-2">\n                Created: ${(new Date).toLocaleString()}\n              </div>\n            </div>\n          `;s.bindPopup(N(t,r)),n(t)}v(),e=!1,u=[]}if("polygon"===t&&e&&m.length>=3){if(s){const e=M(m),t=k(s,"polygon",[m.map(e=>[e.lng,e.lat])],{area:e,points:m.length}),r=`\n            <div class="font-semibold text-green-600 mb-2">⬟ Polygon</div>\n            <div class="text-sm">\n              <div><strong>Points:</strong> ${m.length}</div>\n              <div><strong>Area:</strong> ${e.toFixed(2)} m²</div>\n              <div class="text-gray-500 text-xs mt-2">\n                Created: ${(new Date).toLocaleString()}\n              </div>\n            </div>\n          `;s.bindPopup(N(t,r)),n(t)}v(),e=!1,m=[]}},$=r=>{if(e&&d&&"polyline"!==t&&"polygon"!==t&&"erase"!==t&&"rectangle"!==t){if("circle"===t&&s){const e=s.getRadius(),t=Math.PI*e*e,r=k(s,"circle",[[s.getLatLng().lng,s.getLatLng().lat]],{radius:e,area:t,center:[s.getLatLng().lat,s.getLatLng().lng]}),a=`\n          <div class="font-semibold text-purple-600 mb-2">⭕ Circle</div>\n          <div class="text-sm">\n            <div><strong>Radius:</strong> ${e.toFixed(2)} m</div>\n            <div><strong>Area:</strong> ${t.toFixed(2)} m²</div>\n            <div class="text-gray-500 text-xs mt-2">\n              Created: ${(new Date).toLocaleString()}\n            </div>\n          </div>\n        `;s.bindPopup(N(r,a)),n(r)}v(),e=!1,d=null}},T=t=>{"Escape"===t.key&&(s&&c.removeLayer(s),v(),j(),e=!1,m=[],u=[],g=[],h=0,d=null,a())},O=e=>{let t=0;for(let s=1;s<e.length;s++)t+=e[s-1].distanceTo(e[s]);return t},M=e=>{if(e.length<3)return 0;let t=0;const s=e.length;for(let r=0;r<s;r++){const a=(r+1)%s;t+=e[r].lat*e[a].lng,t-=e[a].lat*e[r].lng}return t=Math.abs(t)/2,111320*t*111320*Math.cos(e[0].lat*Math.PI/180)},P=e=>{const t=e.getNorthEast(),s=e.getSouthWest();return t.distanceTo(r.latLng(t.lat,s.lng))*t.distanceTo(r.latLng(s.lat,t.lng))};c.on("click",C),c.on("mousemove",S),c.on("dblclick",E),c.on("mouseup",$),document.addEventListener("keydown",T);const A=c.getContainer();return A.style.cursor="none"===t?"grab":"crosshair","polyline"!==t&&"polygon"!==t||c.doubleClickZoom.disable(),()=>{c.off("click",C),c.off("mousemove",S),c.off("dblclick",E),c.off("mouseup",$),document.removeEventListener("keydown",T),A.style.cursor="grab",c.doubleClickZoom.enable(),s&&e&&c.removeLayer(s),v(),j()}},[c,t,a,n,l,o,i]),null},q=({drawingMode:t,onDrawingModeChange:s,onEraseMode:r,onUndo:a,canUndo:n,onExport:l})=>{const[o,i]=e.useState({x:0,y:0}),[c,d]=e.useState(!1),[m,u]=e.useState({x:0,y:0}),[x,g]=e.useState(!1),[h,b]=e.useState(!1),[f,y]=e.useState(!1),L=e.useRef(null);e.useEffect(()=>{const e=()=>{const e=window.innerWidth<768||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);y(e),e&&b(!0)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e.useEffect(()=>{if(!x&&L.current){const e=L.current.getBoundingClientRect();if(f){const t=(window.innerWidth-e.width)/2;i({x:t,y:16})}else{const t=(window.innerWidth-e.width)/2;i({x:t,y:16})}g(!0)}},[x,f]),e.useEffect(()=>{const e=()=>{if(L.current&&f){const e=L.current.getBoundingClientRect(),t=(window.innerWidth-e.width)/2;i({x:t,y:16})}};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[f]);const C=e=>{if(!c)return;const t=e.clientX-m.x,s=e.clientY-m.y;E(t,s)},S=e=>{if(!c||!f)return;const t=e.touches[0],s=t.clientX-m.x,r=t.clientY-m.y;E(s,r),e.preventDefault()},E=(e,t)=>{const s=L.current;if(s){const r=s.getBoundingClientRect(),a=window.innerWidth-r.width,n=window.innerHeight-r.height;i({x:Math.max(0,Math.min(e,a)),y:Math.max(0,Math.min(t,n))})}},$=()=>{d(!1)},T=()=>{d(!1)};e.useEffect(()=>{if(c)return f?(document.addEventListener("touchmove",S,{passive:!1}),document.addEventListener("touchend",T)):(document.addEventListener("mousemove",C),document.addEventListener("mouseup",$)),document.body.style.cursor="grabbing",document.body.style.userSelect="none",()=>{f?(document.removeEventListener("touchmove",S),document.removeEventListener("touchend",T)):(document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",$)),document.body.style.cursor="",document.body.style.userSelect=""}},[c,m,o,f]);return H.jsxs("div",{ref:L,className:`fixed z-[1000] bg-white/95 backdrop-blur-md rounded-xl shadow-lg border border-gray-200 ${c?"shadow-2xl scale-105":"shadow-lg"} transition-all duration-200 ${f?"max-w-[90vw]":""}`,style:{left:`${o.x}px`,top:`${o.y}px`,cursor:c?"grabbing":"default"},children:[H.jsxs("div",{className:`drag-handle flex items-center justify-between p-2 border-b border-gray-200 ${f?"cursor-pointer":"cursor-grab hover:bg-gray-50"} transition-colors duration-200`,onMouseDown:e=>{f||(e.target===e.currentTarget||e.target.closest(".drag-handle"))&&(d(!0),u({x:e.clientX-o.x,y:e.clientY-o.y}),e.preventDefault())},onTouchStart:e=>{if(f&&(e.target===e.currentTarget||e.target.closest(".drag-handle"))){const t=e.touches[0];d(!0),u({x:t.clientX-o.x,y:t.clientY-o.y}),e.preventDefault()}},onClick:()=>f&&b(!h),children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[!f&&H.jsx(v,{className:"h-4 w-4 text-gray-400"}),H.jsx("span",{className:"text-gray-500 font-medium "+(f?"text-sm":"text-xs"),children:"Drawing Tools"}),"none"!==t&&H.jsx("div",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-medium text-xs",children:t})]}),f&&H.jsx("button",{className:"p-1 hover:bg-gray-100 rounded",children:h?H.jsx(j,{className:"h-4 w-4"}):H.jsx(p,{className:"h-4 w-4"})})]}),(!f||!h)&&H.jsxs("div",{className:"p-2 "+(f?"p-3":""),children:[H.jsx("div",{className:"flex space-x-2 mb-2 "+(f?"flex-wrap gap-2":""),children:[{mode:"marker",icon:"📍",label:"Marker",color:"hover:bg-red-100"},{mode:"polyline",icon:"📏",label:"Line",color:"hover:bg-blue-100"},{mode:"polygon",icon:"⬟",label:"Polygon",color:"hover:bg-green-100"},{mode:"rectangle",icon:"⬜",label:"Rectangle",color:"hover:bg-yellow-100"},{mode:"circle",icon:"⭕",label:"Circle",color:"hover:bg-purple-100"}].map(e=>H.jsx("button",{onClick:()=>s(t===e.mode?"none":e.mode),className:`${f?"p-2 min-w-[44px] min-h-[44px]":"p-3"} rounded-lg transition-all duration-200 flex items-center justify-center ${t===e.mode?"bg-blue-500 text-white shadow-md scale-105":`bg-gray-100 ${e.color} text-gray-700 hover:scale-105 active:bg-gray-200`}`,title:e.label,children:H.jsx("span",{className:""+(f?"text-base":"text-lg"),children:e.icon})},e.mode))}),H.jsxs("div",{className:"flex space-x-2 pt-2 border-t border-gray-200 "+(f?"gap-2":""),children:[H.jsxs("button",{onClick:r,className:`flex-1 flex items-center justify-center space-x-2 ${f?"p-2 min-h-[44px]":"p-2"} rounded-lg transition-all duration-200 ${"erase"===t?"bg-red-500 text-white shadow-md":"bg-gray-100 hover:bg-red-100 text-gray-700 hover:scale-105 active:bg-gray-200"}`,title:"Eraser - Tap features to delete",children:[H.jsx(w,{className:""+(f?"h-5 w-5":"h-4 w-4")}),!f&&H.jsx("span",{className:"text-xs font-medium",children:"Erase"})]}),H.jsxs("button",{onClick:a,disabled:!n,className:`flex-1 flex items-center justify-center space-x-2 ${f?"p-2 min-h-[44px]":"p-2"} rounded-lg transition-all duration-200 ${n?"bg-gray-100 hover:bg-orange-100 text-gray-700 hover:scale-105 active:bg-gray-200":"bg-gray-50 text-gray-400 cursor-not-allowed"}`,title:"Undo last action",children:[H.jsx(N,{className:""+(f?"h-5 w-5":"h-4 w-4")}),!f&&H.jsx("span",{className:"text-xs font-medium",children:"Undo"})]}),H.jsxs("button",{onClick:l,className:`flex-1 flex items-center justify-center space-x-2 ${f?"p-2 min-h-[44px]":"p-2"} rounded-lg transition-all duration-200 bg-gray-100 hover:bg-green-100 text-gray-700 hover:scale-105 active:bg-gray-200`,title:"Export data to CSV",children:[H.jsx(k,{className:""+(f?"h-5 w-5":"h-4 w-4")}),!f&&H.jsx("span",{className:"text-xs font-medium",children:"Export"})]})]})]}),(!f||!h)&&"none"!==t&&H.jsx("div",{className:"px-3 pb-3 "+(f?"px-4 pb-4":""),children:H.jsxs("div",{className:"border rounded-lg p-2 "+("erase"===t?"bg-red-50 border-red-200":"rectangle"===t?"bg-yellow-50 border-yellow-200":"bg-blue-50 border-blue-200"),children:[H.jsx("p",{className:`font-medium ${"erase"===t?"text-red-700":"rectangle"===t?"text-yellow-700":"text-blue-700"} ${f?"text-sm":"text-xs"}`,children:(()=>{switch(t){case"marker":return"📍 Tap to place markers";case"polyline":return"📏 Tap points, double-tap to finish";case"polygon":return"⬟ Tap vertices, double-tap to close";case"rectangle":return"⬜ Tap 3 points: corner → side → height";case"circle":return"⭕ Tap center, drag to set radius";case"erase":return"🗑️ Tap features to delete";default:return""}})()}),!f&&H.jsx("p",{className:"text-xs mt-1 "+("erase"===t?"text-red-600":"rectangle"===t?"text-yellow-600":"text-blue-600"),children:"rectangle"===t?"Three-point method for precise rectangles":"marker"===t?"Tool stays active - keep tapping to add more":"circle"===t?"Tool stays active - create multiple circles":"Tap to exit tool • Tap popup button for attributes"})]})})]})},Q=({vectorLayers:t,onLayersChange:s})=>{const[r,a]=e.useState(!1),n=e.useRef(null),l=window.innerWidth<768;return H.jsxs("div",{className:"bg-white/95 backdrop-blur-md rounded-xl shadow-lg overflow-hidden",children:[H.jsx("div",{className:"p-3 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors duration-200",onClick:()=>a(!r),children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx(L,{className:(l?"h-4 w-4":"h-5 w-5")+" text-gray-700"}),H.jsx("h3",{className:"font-semibold text-gray-800 "+(l?"text-sm":""),children:"Vector Layers"}),t.length>0&&H.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs",children:t.length})]}),H.jsx("div",{className:"transform transition-transform duration-200 "+(r?"rotate-180":""),children:H.jsx(p,{className:"w-4 h-4 text-gray-500"})})]})}),r&&H.jsxs("div",{className:"p-3 "+(l?"p-4":""),children:[H.jsxs("div",{className:"mb-4",children:[H.jsx("input",{ref:n,type:"file",accept:".json,.geojson",onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];if(!a)return;const l=new FileReader;l.onload=e=>{var r;try{const n=null==(r=e.target)?void 0:r.result,l=JSON.parse(n);if(!l.type||"FeatureCollection"!==l.type&&"Feature"!==l.type)throw new Error("Invalid GeoJSON format");const o={id:Date.now().toString(),name:a.name.replace(/\.[^/.]+$/,""),data:l,visible:!0,color:`#${Math.floor(16777215*Math.random()).toString(16)}`,opacity:.7,type:"geojson"};s([...t,o])}catch(n){alert("Error parsing JSON file. Please ensure it's a valid GeoJSON format."),console.error("JSON parsing error:",n)}},l.readAsText(a),n.current&&(n.current.value="")},className:"hidden"}),H.jsxs("button",{onClick:()=>{var e;return null==(e=n.current)?void 0:e.click()},className:"w-full flex items-center justify-center space-x-2 p-3 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-400 hover:bg-blue-50 transition-all duration-200 text-gray-600 hover:text-blue-600 "+(l?"min-h-[44px]":""),children:[H.jsx(C,{className:""+(l?"h-4 w-4":"h-5 w-5")}),H.jsx("span",{className:"font-medium "+(l?"text-sm":""),children:"Upload GeoJSON"})]}),H.jsx("p",{className:"text-gray-500 mt-2 text-center text-xs",children:"Supports .json and .geojson files"})]}),t.length>0?H.jsx("div",{className:`space-y-3 ${l?"max-h-48":"max-h-64"} overflow-y-auto`,children:t.map(e=>{var r;return H.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[H.jsxs("div",{className:"flex items-center justify-between mb-2",children:[H.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[H.jsx("button",{onClick:()=>{return r=e.id,void s(t.map(e=>e.id===r?{...e,visible:!e.visible}:e));var r},className:`p-1 rounded transition-colors duration-200 ${e.visible?"text-blue-600 hover:bg-blue-100":"text-gray-400 hover:bg-gray-200"} ${l?"min-w-[32px] min-h-[32px]":""}`,children:e.visible?H.jsx(S,{className:"h-4 w-4"}):H.jsx(E,{className:"h-4 w-4"})}),H.jsx("span",{className:"font-medium text-gray-800 truncate text-sm",title:e.name,children:e.name})]}),H.jsxs("div",{className:"flex items-center space-x-1",children:[H.jsx("button",{onClick:()=>(e=>{const t=JSON.stringify(e.data,null,2),s=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${e.name}.geojson`,a.click(),URL.revokeObjectURL(r)})(e),className:"p-1 text-gray-500 hover:text-blue-600 hover:bg-blue-100 rounded transition-colors duration-200 "+(l?"min-w-[32px] min-h-[32px]":""),title:"Export layer",children:H.jsx(k,{className:"h-4 w-4"})}),H.jsx("button",{onClick:()=>{return r=e.id,void s(t.filter(e=>e.id!==r));var r},className:"p-1 text-gray-500 hover:text-red-600 hover:bg-red-100 rounded transition-colors duration-200 "+(l?"min-w-[32px] min-h-[32px]":""),title:"Remove layer",children:H.jsx($,{className:"h-4 w-4"})})]})]}),H.jsxs("div",{className:"space-y-2",children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("label",{className:"text-gray-600 w-12 text-xs",children:"Color:"}),H.jsx("input",{type:"color",value:e.color,onChange:r=>{return a=e.id,n=r.target.value,void s(t.map(e=>e.id===a?{...e,color:n}:e));var a,n},className:"rounded border border-gray-300 cursor-pointer "+(l?"w-10 h-8":"w-8 h-6")})]}),H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("label",{className:"text-gray-600 w-12 text-xs",children:"Opacity:"}),H.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:e.opacity,onChange:r=>{return a=e.id,n=parseFloat(r.target.value),void s(t.map(e=>e.id===a?{...e,opacity:n}:e));var a,n},className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),H.jsxs("span",{className:"text-gray-600 w-8 text-xs",children:[Math.round(100*e.opacity),"%"]})]})]}),H.jsx("div",{className:"mt-2 text-gray-500 text-xs",children:"FeatureCollection"===e.data.type?`${(null==(r=e.data.features)?void 0:r.length)||0} features`:"1 feature"})]},e.id)})}):H.jsxs("div",{className:"text-center py-6 text-gray-500",children:[H.jsx(L,{className:(l?"h-6 w-6":"h-8 w-8")+" mx-auto mb-2 opacity-50"}),H.jsx("p",{className:"text-sm",children:"No vector layers loaded"}),H.jsx("p",{className:"mt-1 text-xs",children:"Upload GeoJSON files to get started"})]})]})]})},ee=({vectorLayers:t})=>{const a=s();return e.useEffect(()=>{const e={};return t.forEach(t=>{if(e[t.id]&&a.removeLayer(e[t.id]),!t.visible)return;const s=r.layerGroup(),n=e=>({color:t.color,weight:2,opacity:t.opacity,fillColor:t.color,fillOpacity:.5*t.opacity}),l=(e,t)=>r.circleMarker(t,{radius:6,...n()}),o=(e,s)=>{if(e.properties){const r=Object.entries(e.properties).map(([e,t])=>`<strong>${e}:</strong> ${t}`).join("<br>");s.bindPopup(`\n            <div class="p-2">\n              <div class="font-semibold text-blue-600 mb-2">${t.name}</div>\n              ${r}\n            </div>\n          `)}};try{const i=r.geoJSON(t.data,{style:n,pointToLayer:l,onEachFeature:o});s.addLayer(i),e[t.id]=s,a.addLayer(s)}catch(i){console.error(`Error rendering vector layer ${t.name}:`,i)}}),()=>{Object.values(e).forEach(e=>{a.hasLayer(e)&&a.removeLayer(e)})}},[a,t]),null},te=({feature:t,isOpen:s,onClose:r,onSave:a})=>{const[n,l]=e.useState({}),[o,i]=e.useState(""),[d,m]=e.useState("");e.useEffect(()=>{if(t&&s){const e=t.properties.attributes||{};l(e)}},[t,s]);const u=()=>{o.trim()&&d.trim()&&(l(e=>({...e,[o.trim()]:d.trim()})),i(""),m(""))},x=e=>{"Enter"===e.key&&o.trim()&&d.trim()&&u()};if(!s||!t)return null;const g={marker:["name","type","description","category","status"],polyline:["name","type","length","material","condition","usage"],polygon:["landuse","name","area","zoning","ownership","description"],rectangle:["landuse","building_type","name","area","floors","usage"],circle:["name","type","radius","category","description","buffer_zone"]}[t.type]||["name","type","description"];return H.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:H.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[H.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center space-x-3",children:[H.jsx(T,{className:"h-6 w-6"}),H.jsxs("div",{children:[H.jsx("h2",{className:"text-xl font-bold",children:"Feature Attributes"}),H.jsxs("p",{className:"text-blue-100 text-sm",children:[t.type.charAt(0).toUpperCase()+t.type.slice(1)," • ID: ",t.id.slice(-8)]})]})]}),H.jsx("button",{onClick:r,className:"p-2 hover:bg-white/20 rounded-lg transition-colors duration-200",children:H.jsx(O,{className:"h-5 w-5"})})]})}),H.jsxs("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[H.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[H.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Feature Information"}),H.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[H.jsxs("div",{children:[H.jsx("span",{className:"text-gray-600",children:"Type:"}),H.jsx("span",{className:"ml-2 font-medium",children:t.type})]}),H.jsxs("div",{children:[H.jsx("span",{className:"text-gray-600",children:"Created:"}),H.jsx("span",{className:"ml-2 font-medium",children:t.properties.created})]}),t.properties.area&&H.jsxs("div",{children:[H.jsx("span",{className:"text-gray-600",children:"Area:"}),H.jsxs("span",{className:"ml-2 font-medium",children:[t.properties.area.toFixed(2)," m²"]})]}),t.properties.distance&&H.jsxs("div",{children:[H.jsx("span",{className:"text-gray-600",children:"Distance:"}),H.jsxs("span",{className:"ml-2 font-medium",children:[t.properties.distance.toFixed(2)," m"]})]})]})]}),H.jsxs("div",{className:"mb-6",children:[H.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Quick Add Attributes"}),H.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(e=>H.jsx("button",{onClick:()=>(e=>{n[e]||i(e)})(e),disabled:!!n[e],className:"px-3 py-1 rounded-full text-sm font-medium transition-colors duration-200 "+(n[e]?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:e},e))})]}),Object.keys(n).length>0&&H.jsxs("div",{className:"mb-6",children:[H.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Current Attributes"}),H.jsx("div",{className:"space-y-3",children:Object.entries(n).map(([e,t])=>H.jsxs("div",{className:"flex items-center space-x-3 bg-gray-50 rounded-lg p-3",children:[H.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-3",children:[H.jsx("input",{type:"text",value:e,onChange:t=>{const s=t.target.value,r=n[e];l(t=>{const a={...t};return delete a[e],s.trim()&&(a[s.trim()]=r),a})},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-medium",placeholder:"Attribute name"}),H.jsx("input",{type:"text",value:t,onChange:t=>((e,t)=>{l(s=>({...s,[e]:t}))})(e,t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Attribute value"})]}),H.jsx("button",{onClick:()=>(e=>{l(t=>{const s={...t};return delete s[e],s})})(e),className:"p-2 text-red-500 hover:bg-red-100 rounded-lg transition-colors duration-200",children:H.jsx($,{className:"h-4 w-4"})})]},e))})]}),H.jsxs("div",{className:"mb-6",children:[H.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Add New Attribute"}),H.jsxs("div",{className:"flex items-center space-x-3",children:[H.jsx("input",{type:"text",value:o,onChange:e=>i(e.target.value),onKeyPress:x,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Attribute name (e.g., landuse, building_type)"}),H.jsx("input",{type:"text",value:d,onChange:e=>m(e.target.value),onKeyPress:x,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Attribute value (e.g., residential, commercial)"}),H.jsx("button",{onClick:u,disabled:!o.trim()||!d.trim(),className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200",children:H.jsx(c,{className:"h-4 w-4"})})]})]})]}),H.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:[H.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),H.jsxs("button",{onClick:()=>{a(n),r()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2",children:[H.jsx(M,{className:"h-4 w-4"}),H.jsx("span",{children:"Save Attributes"})]})]})]})})},se=({drawnFeatures:t,isOpen:s,onClose:r})=>{const[a,n]=e.useState(["marker","polyline","polygon","rectangle","circle"]),[l,o]=e.useState(!0),[i,c]=e.useState(!0),d=()=>({point:t.filter(e=>"marker"===e.type),line:t.filter(e=>"polyline"===e.type),polygon:t.filter(e=>["polygon","rectangle","circle"].includes(e.type))}),m=e=>{if("marker"===e.type)return`"POINT(${e.coordinates[0][0]} ${e.coordinates[0][1]})"`;if("polyline"===e.type){return`"LINESTRING(${e.coordinates.map(e=>`${e[0]} ${e[1]}`).join(", ")})"`}if("circle"===e.type){const t=e.coordinates[0],s=e.properties.radius||100;return`"POINT(${t[0]} ${t[1]})" BUFFER ${s}`}return`"POLYGON((${e.coordinates[0].map(e=>`${e[0]} ${e[1]}`).join(", ")}))"`},u=(e,t)=>{if(0===e.length)return"";const s=(e=>{const t=new Set;return e.forEach(e=>{e.properties.attributes&&Object.keys(e.properties.attributes).forEach(e=>t.add(e))}),Array.from(t).sort()})(e),r=e.some(e=>{var t;return void 0!==(null==(t=e.properties)?void 0:t.area)}),a=e.some(e=>{var t;return void 0!==(null==(t=e.properties)?void 0:t.distance)}),n=e.some(e=>{var t;return void 0!==(null==(t=e.properties)?void 0:t.radius)}),o=["id","feature_type","created_date","created_time",...l?["geometry_wkt"]:[],...r?["area_m2"]:[],...a?["length_m"]:[],...n?["radius_m"]:[],...i?s:[]],c=e.map(e=>{var t,o,c,d,u,x;const g=new Date(e.timestamp);return[e.id,e.type,g.toLocaleDateString(),g.toLocaleTimeString(),...l?[m(e)]:[],...r?[(null==(o=null==(t=e.properties)?void 0:t.area)?void 0:o.toFixed(2))||""]:[],...a?[(null==(d=null==(c=e.properties)?void 0:c.distance)?void 0:d.toFixed(2))||""]:[],...n?[(null==(x=null==(u=e.properties)?void 0:u.radius)?void 0:x.toFixed(2))||""]:[],...i?s.map(t=>{var s;return(null==(s=e.properties.attributes)?void 0:s[t])||""}):[]].map(e=>{const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?`"${t.replace(/"/g,'""')}"`:t})});return"\ufeff"+[o.join(","),...c.map(e=>e.join(","))].join("\n")};if(!s)return null;const x=d(),g=t.length;return H.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center bg-black/50 backdrop-blur-sm",children:H.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden font-thai",children:[H.jsx("div",{className:"bg-gradient-to-r from-green-600 to-blue-600 text-white p-6",children:H.jsxs("div",{className:"flex items-center justify-between",children:[H.jsxs("div",{className:"flex items-center space-x-3",children:[H.jsx(P,{className:"h-6 w-6"}),H.jsxs("div",{children:[H.jsx("h2",{className:"text-xl font-bold",children:"Export Data"}),H.jsxs("p",{className:"text-green-100 text-sm",children:["Export ",g," features to CSV format with UTF-8 encoding"]})]})]}),H.jsx("button",{onClick:r,className:"p-2 hover:bg-white/20 rounded-lg transition-colors duration-200",children:H.jsx("span",{className:"text-xl",children:"×"})})]})}),H.jsxs("div",{className:"p-6 max-h-[60vh] overflow-y-auto",children:[H.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[H.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 text-center",children:[H.jsx("div",{className:"text-2xl font-bold text-blue-600",children:x.point.length}),H.jsx("div",{className:"text-sm text-blue-700",children:"Points"}),H.jsx("div",{className:"text-xs text-gray-500",children:"Markers"})]}),H.jsxs("div",{className:"bg-green-50 rounded-lg p-4 text-center",children:[H.jsx("div",{className:"text-2xl font-bold text-green-600",children:x.line.length}),H.jsx("div",{className:"text-sm text-green-700",children:"Lines"}),H.jsx("div",{className:"text-xs text-gray-500",children:"Polylines"})]}),H.jsxs("div",{className:"bg-purple-50 rounded-lg p-4 text-center",children:[H.jsx("div",{className:"text-2xl font-bold text-purple-600",children:x.polygon.length}),H.jsx("div",{className:"text-sm text-purple-700",children:"Polygons"}),H.jsx("div",{className:"text-xs text-gray-500",children:"Areas & Shapes"})]})]}),H.jsxs("div",{className:"space-y-6",children:[H.jsxs("div",{children:[H.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[H.jsx(A,{className:"h-5 w-5 mr-2"}),"Export Options"]}),H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{children:[H.jsxs("label",{className:"flex items-center space-x-3",children:[H.jsx("input",{type:"checkbox",checked:l,onChange:e=>o(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),H.jsx("span",{className:"text-sm font-medium",children:"Include Geometry (WKT format)"})]}),H.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Exports coordinates in Well-Known Text format for GIS applications"})]}),H.jsxs("div",{children:[H.jsxs("label",{className:"flex items-center space-x-3",children:[H.jsx("input",{type:"checkbox",checked:i,onChange:e=>c(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),H.jsx("span",{className:"text-sm font-medium",children:"Include Custom Attributes (UTF-8 encoded)"})]}),H.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Exports all custom attributes with proper Thai character encoding"})]})]})]}),H.jsxs("div",{children:[H.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"CSV Preview"}),H.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 font-mono text-xs overflow-x-auto csv-content",children:[H.jsx("div",{className:"text-gray-600 mb-2",children:"Sample columns that will be included:"}),H.jsxs("div",{className:"text-gray-800",children:["id, feature_type, created_date, created_time",l&&", geometry_wkt",", area_m2, length_m, radius_m (when applicable)",i&&", [custom_attributes_with_thai_support...]"]}),H.jsx("div",{className:"text-green-600 mt-2 text-xs",children:"✓ UTF-8 BOM included for proper Thai character display"})]})]})]})]}),H.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-between",children:[H.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),H.jsxs("div",{className:"flex space-x-3",children:[H.jsxs("button",{onClick:()=>{const e=d(),t=(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-");Object.entries(e).forEach(([e,s])=>{if(s.length>0){const r=u(s);if(r){const s=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(s);a.setAttribute("href",n),a.setAttribute("download",`map_features_${e}_${t}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}}}),r()},disabled:0===g,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center space-x-2",children:[H.jsx(k,{className:"h-4 w-4"}),H.jsx("span",{children:"Export by Type"})]}),H.jsxs("button",{onClick:()=>{const e=t.filter(e=>a.includes(e.type));if(0===e.length)return;const s=u(e),n=(new Date).toISOString().slice(0,19).replace(/[:.]/g,"-"),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),i=URL.createObjectURL(l);o.setAttribute("href",i),o.setAttribute("download",`map_features_all_${n}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),r()},disabled:0===g,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center space-x-2",children:[H.jsx(L,{className:"h-4 w-4"}),H.jsx("span",{children:"Export All"})]})]})]})]})})},re=({isActive:t,measurementType:a,onMeasurementComplete:n,onCancel:l})=>{const o=s();return e.useEffect(()=>{if(!o||!t||!a)return;let e=!1,s=[],i=[],c=null,d=null,m=null;const u=(e="#ff6b35")=>r.divIcon({className:"measurement-marker",html:`<div class="w-3 h-3 bg-white border-2 rounded-full shadow-lg" style="border-color: ${e}"></div>`,iconSize:[12,12],iconAnchor:[6,6]}),x=(e,t="#ff6b35")=>r.divIcon({className:"measurement-label",html:`\n          <div class="bg-white border-2 rounded-lg px-3 py-2 shadow-lg text-sm font-bold whitespace-nowrap" \n               style="border-color: ${t}; color: ${t};">\n            ${e}\n          </div>\n        `,iconSize:[0,0],iconAnchor:[0,0]}),g=(e,t="#ff6b35")=>{const s=r.marker(e,{icon:u(t)}).addTo(o);return i.push(s),s},h=()=>{i.forEach(e=>o.removeLayer(e)),i=[],c&&o.hasLayer(c)&&(o.removeLayer(c),c=null),d&&o.hasLayer(d)&&(o.removeLayer(d),d=null),m&&o.hasLayer(m)&&(o.removeLayer(m),m=null)},p=e=>{let t=0;for(let s=1;s<e.length;s++)t+=e[s-1].distanceTo(e[s]);return t},b=e=>{if(e.length<3)return 0;let t=0;const s=e.length;for(let r=0;r<s;r++){const a=(r+1)%s;t+=e[r].lat*e[a].lng,t-=e[a].lat*e[r].lng}return t=Math.abs(t)/2,111320*t*111320*Math.cos(e[0].lat*Math.PI/180)},f=()=>{var e,t;if(!(s.length<2))if("distance"===a){c?c.setLatLngs(s):c=r.polyline(s,{color:"#ff6b35",weight:3,opacity:.8,dashArray:"5, 10"}).addTo(o);const e=p(s),a=s[Math.floor(s.length/2)];m&&o.removeLayer(m),m=r.marker(a,{icon:x((t=e,t<1e3?`${t.toFixed(1)} m`:`${(t/1e3).toFixed(2)} km`),"#ff6b35")}).addTo(o)}else if("area"===a&&s.length>=3){d?d.setLatLngs(s):d=r.polygon(s,{color:"#10b981",weight:3,fillOpacity:.2,fillColor:"#10b981",opacity:.8,dashArray:"5, 10"}).addTo(o);const t=b(s),a=r.latLngBounds(s).getCenter();m&&o.removeLayer(m),m=r.marker(a,{icon:x((e=t,e<1e4?`${e.toFixed(1)} m²`:`${(e/1e4).toFixed(2)} ha`),"#10b981")}).addTo(o)}},y=t=>{"distance"===a?(s.push(t.latlng),g(t.latlng,"#ff6b35"),f()):"area"===a&&(e?(s.push(t.latlng),g(t.latlng,"#10b981"),f()):(e=!0,s=[t.latlng],g(t.latlng,"#10b981")))},v=e=>{if(e.originalEvent.preventDefault(),"distance"===a&&s.length>=2){const e=p(s);n({value:e,unit:e<1e3?"m":"km",type:"distance"})}else if("area"===a&&s.length>=3){const e=b(s);n({value:e,unit:e<1e4?"m²":"ha",type:"area"})}},j=e=>{"Escape"===e.key&&(h(),l())};o.on("click",y),o.on("dblclick",v),document.addEventListener("keydown",j);const w=o.getContainer();return w.style.cursor="crosshair",o.doubleClickZoom.disable(),()=>{o.off("click",y),o.off("dblclick",v),document.removeEventListener("keydown",j),w.style.cursor="grab",o.doubleClickZoom.enable(),h()}},[o,t,a,n,l]),null};delete r.Icon.Default.prototype._getIconUrl,r.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const ae=()=>{const[t,c]=e.useState(["satellite"]),[d,m]=e.useState("none"),[u,x]=e.useState(null),[g,h]=e.useState(0),[p,b]=e.useState(!1),[f,y]=e.useState([]),[v,j]=e.useState([]),[w,N]=e.useState([]),[k,L]=e.useState(null),[C,S]=e.useState(!1),[E,$]=e.useState(!1),[T,O]=e.useState(0),[M,P]=e.useState(!1),[A,F]=e.useState(!1),[D,R]=e.useState(!1),[_,z]=e.useState(null),[I,U]=e.useState(null),G=e.useRef(null);e.useEffect(()=>{const e=()=>{const e=window.innerWidth<768;P(e),e&&F(!0)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),e.useEffect(()=>{let e;return p&&"geolocation"in navigator&&(e=navigator.geolocation.watchPosition(e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy,heading:e.coords.heading||0};x(t),O(e.coords.accuracy),G.current&&!u&&G.current.setView([t.lat,t.lng],18)},e=>{console.error("GPS Error:",e);let t="GPS Error: ";switch(e.code){case e.PERMISSION_DENIED:t+="Location access denied. Please enable location permissions.";break;case e.POSITION_UNAVAILABLE:t+="Location information unavailable.";break;case e.TIMEOUT:t+="Location request timed out.";break;default:t+="Unknown error occurred."}alert(t),b(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:1e3})),()=>{e&&navigator.geolocation.clearWatch(e)}},[p,u]);const B={satellite:{url:"https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"© Google Satellite"},hybrid:{url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"© Google Hybrid"},openstreet:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}},W=()=>{const e=s();return G.current=e,i({rotate:e=>{h(e.target.getBearing())}}),null};return H.jsxs("div",{className:"relative h-full w-full",children:[H.jsxs(a,{center:[40.7128,-74.006],zoom:13,className:"h-full w-full",zoomControl:!1,attributionControl:!1,children:[H.jsx(W,{}),t.map(e=>H.jsx(n,{url:B[e].url,attribution:B[e].attribution,opacity:e===t[0]?1:.7},e)),u&&p&&H.jsxs(H.Fragment,{children:[H.jsx(l,{center:[u.lat,u.lng],radius:T,pathOptions:{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.1,weight:2,opacity:.5}}),H.jsx(o,{position:[u.lat,u.lng],icon:r.divIcon({className:"gps-position-marker",html:'\n      <div class="relative">\n        <div class="w-6 h-6 bg-blue-500 rounded-full border-4 border-white shadow-lg animate-pulse"></div>\n        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-2 h-2 bg-white rounded-full"></div>\n      </div>\n    ',iconSize:[24,24],iconAnchor:[12,12]}),children:H.jsxs("div",{className:"bg-white p-3 rounded-lg shadow-lg min-w-[200px]",children:[H.jsxs("div",{className:"font-semibold text-blue-600 mb-2 flex items-center",children:[H.jsx("span",{className:"mr-2",children:"📍"}),"Current Position"]}),H.jsxs("div",{className:"text-sm space-y-1",children:[H.jsxs("div",{children:[H.jsx("strong",{children:"Latitude:"})," ",u.lat.toFixed(6)]}),H.jsxs("div",{children:[H.jsx("strong",{children:"Longitude:"})," ",u.lng.toFixed(6)]}),H.jsxs("div",{children:[H.jsx("strong",{children:"Accuracy:"})," ±",Math.round(u.accuracy),"m"]}),null!==u.heading&&u.heading>0&&H.jsxs("div",{children:[H.jsx("strong",{children:"Heading:"})," ",Math.round(u.heading),"°"]}),H.jsxs("div",{className:"text-gray-500 text-xs mt-2",children:["Updated: ",(new Date).toLocaleTimeString()]})]})]})})]}),H.jsx(X,{drawingMode:d,onDrawingComplete:()=>m("none"),onFeatureDrawn:e=>{console.log("Feature drawn:",e.id,e.type),j(t=>[...t,e]),N([])},onFeatureClick:e=>{if(console.log("Feature click handler called:",e.id,"Mode:",d),"erase"===d){console.log("Processing erase for feature:",e.id,e.type),G.current&&e.layer&&G.current.hasLayer(e.layer)&&(G.current.removeLayer(e.layer),console.log("Feature removed from map successfully")),j(t=>{const s=t.filter(t=>t.id!==e.id);return console.log("Features updated - before:",t.length,"after:",s.length),s}),N(t=>[...t,e]);const t=document.createElement("div");t.className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[9999] bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg font-medium",t.innerHTML=`✅ ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} deleted successfully`,document.body.appendChild(t),t.style.opacity="0",t.style.transform="translate(-50%, -20px)",setTimeout(()=>{t.style.transition="all 0.3s ease",t.style.opacity="1",t.style.transform="translate(-50%, 0)"},10),setTimeout(()=>{t.style.opacity="0",t.style.transform="translate(-50%, -20px)",setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},300)},2e3)}},onFeatureDoubleClick:e=>{console.log("Feature double-clicked for attribute editing:",e.id),L(e),S(!0)},drawnFeatures:v}),H.jsx(re,{isActive:D,measurementType:_,onMeasurementComplete:e=>{U(e),R(!1),z(null);const t=document.createElement("div");t.className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[9999] bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg font-medium";const s="km"===e.unit||"ha"===e.unit?(e.value/("km"===e.unit?1e3:1e4)).toFixed(2):e.value.toFixed(1);t.innerHTML=`📏 ${"distance"===e.type?"Distance":"Area"}: ${s} ${e.unit}`,document.body.appendChild(t),setTimeout(()=>{t.style.transition="all 0.3s ease",t.style.opacity="0",t.style.transform="translate(-50%, -20px)",setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},300)},3e3)},onCancel:()=>{R(!1),z(null),U(null)}}),H.jsx(ee,{vectorLayers:f})]}),H.jsx(q,{drawingMode:d,onDrawingModeChange:m,onEraseMode:()=>{m("erase"===d?"none":"erase")},onUndo:()=>{if(0===v.length)return;const e=v[v.length-1];G.current&&e.layer&&G.current.hasLayer(e.layer)&&G.current.removeLayer(e.layer),N(t=>[...t,e]),j(e=>e.slice(0,-1))},canUndo:v.length>0,onExport:()=>$(!0)}),H.jsx("div",{className:`absolute ${M?"top-2 left-2":"top-4 left-4"} z-[999]`,children:!M&&H.jsx(Y,{rotation:g})}),H.jsx(J,{onZoomIn:()=>{var e;return null==(e=G.current)?void 0:e.zoomIn()},onZoomOut:()=>{var e;return null==(e=G.current)?void 0:e.zoomOut()},onResetView:()=>{u&&G.current?G.current.setView([u.lat,u.lng],18):G.current&&G.current.setView([40.7128,-74.006],13)},onToggleGPS:()=>{if(!p){if(!("geolocation"in navigator))return void alert("Geolocation is not supported by this browser.");const e=document.createElement("div");e.className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[9999] bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg font-medium",e.innerHTML="🛰️ Searching for GPS signal...",document.body.appendChild(e),setTimeout(()=>{document.body.contains(e)&&document.body.removeChild(e)},3e3)}b(!p)},isGPSActive:p,onStartMeasurement:e=>{D&&_===e?(R(!1),z(null),U(null)):(m("none"),R(!0),z(e),U(null))},isMeasuring:D,measurementType:_}),!M&&H.jsxs("div",{className:"absolute left-4 top-24 bottom-4 z-[999] flex flex-col space-y-4 max-w-sm",children:[H.jsx(Q,{vectorLayers:f,onLayersChange:y}),H.jsx(Z,{selectedLayers:t,onLayerChange:c})]}),M&&H.jsx("button",{onClick:()=>F(!A),className:"absolute top-16 left-2 z-[999] bg-white/90 backdrop-blur-md rounded-lg shadow-lg p-2 active:bg-gray-100",children:H.jsx("span",{className:"text-sm",children:"☰"})}),M&&!A&&H.jsxs("div",{className:"absolute left-2 top-24 bottom-20 z-[999] flex flex-col space-y-2 w-72 max-w-[calc(100vw-16px)]",children:[H.jsx(Q,{vectorLayers:f,onLayersChange:y}),H.jsx(Z,{selectedLayers:t,onLayerChange:c})]}),H.jsx("div",{className:`absolute ${M?"bottom-20 right-2":"bottom-4 right-4"} z-[999]`,children:H.jsx(K,{position:u,isTracking:p})}),(v.length>0||w.length>0)&&H.jsx("div",{className:`absolute ${M?"bottom-2 left-1/2":"bottom-4 left-1/2"} transform -translate-x-1/2 z-[999]`,children:H.jsx("div",{className:"bg-white/95 backdrop-blur-md rounded-lg shadow-lg px-4 py-2",children:H.jsxs("div",{className:"flex items-center space-x-3 "+(M?"text-xs":"text-sm"),children:[H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),H.jsx("span",{className:"text-gray-600",children:"Active:"}),H.jsx("span",{className:"font-semibold text-blue-600",children:v.length})]}),w.length>0&&H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("div",{className:"w-2 h-2 bg-red-400 rounded-full"}),H.jsx("span",{className:"text-gray-500",children:"Deleted:"}),H.jsx("span",{className:"font-medium text-red-500",children:w.length})]}),v.some(e=>e.properties.attributes&&Object.keys(e.properties.attributes).length>0)&&H.jsxs("div",{className:"flex items-center space-x-2",children:[H.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),H.jsx("span",{className:"text-gray-600",children:"With Attributes:"}),H.jsx("span",{className:"font-semibold text-green-600",children:v.filter(e=>e.properties.attributes&&Object.keys(e.properties.attributes).length>0).length})]})]})})}),D&&H.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[998] pointer-events-none",children:H.jsx("div",{className:`${"distance"===_?"bg-orange-500/20 border-orange-500":"bg-green-500/20 border-green-500"} border-2 border-dashed rounded-full ${M?"w-32 h-32":"w-40 h-40"} flex items-center justify-center animate-pulse`,children:H.jsxs("div",{className:("distance"===_?"text-orange-600":"text-green-600")+" text-center",children:[H.jsx("div",{className:(M?"text-2xl":"text-3xl")+" mb-2",children:"distance"===_?"📏":"📐"}),H.jsx("div",{className:(M?"text-xs":"text-sm")+" font-bold",children:"distance"===_?"DISTANCE MODE":"AREA MODE"}),H.jsx("div",{className:"text-xs mt-1",children:"distance"===_?"Tap points, double-tap to finish":"Tap vertices, double-tap to close"})]})})}),p&&!u&&H.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[998] pointer-events-none",children:H.jsxs("div",{className:"bg-blue-500/90 text-white rounded-2xl p-6 text-center shadow-lg "+(M?"max-w-xs":"max-w-md"),children:[H.jsx("div",{className:"text-3xl mb-3",children:"🛰️"}),H.jsx("h3",{className:(M?"text-base":"text-lg")+" font-bold mb-2",children:"Searching for GPS Signal"}),H.jsx("p",{className:`text-blue-100 ${M?"text-xs":"text-sm"} mb-3`,children:"Please ensure location services are enabled and you're in an area with good satellite reception."}),H.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[H.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),H.jsx("span",{className:"text-sm",children:"Acquiring position..."})]})]})}),"erase"===d&&H.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[998] pointer-events-none",children:H.jsx("div",{className:`bg-red-500/20 border-2 border-red-500 border-dashed rounded-full ${M?"w-32 h-32":"w-40 h-40"} flex items-center justify-center animate-pulse`,children:H.jsxs("div",{className:"text-red-600 text-center",children:[H.jsx("div",{className:(M?"text-2xl":"text-3xl")+" mb-2",children:"🗑️"}),H.jsx("div",{className:(M?"text-xs":"text-sm")+" font-bold",children:"ERASE MODE"}),H.jsx("div",{className:"text-xs mt-1",children:"Tap features to delete"})]})})}),H.jsx(te,{feature:k,isOpen:C,onClose:()=>{S(!1),L(null)},onSave:e=>{if(k){const t={...k,properties:{...k.properties,attributes:e}};if(j(e=>e.map(e=>e.id===k.id?t:e)),k.layer&&k.layer instanceof r.Layer){Object.entries(e).map(([e,t])=>`<div><strong>${e}:</strong> ${t}</div>`).join("");const t=k.layer.getPopup();t&&(t.getContent(),setTimeout(()=>{k.layer.getPopup()&&k.layer.getPopup().update()},100))}console.log("Attributes saved for feature:",k.id,e)}}}),H.jsx(se,{drawnFeatures:v,isOpen:E,onClose:()=>$(!1)}),"none"===d&&0===v.length&&!p&&!D&&H.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[998] pointer-events-none",children:H.jsxs("div",{className:"bg-white/90 backdrop-blur-md rounded-2xl p-8 text-center shadow-lg "+(M?"max-w-xs mx-4":"max-w-md"),children:[H.jsx("div",{className:"text-4xl mb-4",children:"🗺️"}),H.jsx("h3",{className:(M?"text-lg":"text-xl")+" font-bold text-gray-800 mb-2",children:"Welcome to Map Field Collector"}),H.jsx("p",{className:`text-gray-600 ${M?"text-xs":"text-sm"} mb-4`,children:"Start by enabling GPS tracking, using measurement tools, or selecting a drawing tool to create features on the map."}),H.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[H.jsx("div",{children:"• Tap GPS button to track your location"}),H.jsx("div",{children:"• Use ruler 📏 and area 📐 tools for measurements"}),H.jsx("div",{children:"• Use drawing tools to mark features"}),H.jsx("div",{children:"• Tap popup buttons to add attributes"}),H.jsx("div",{children:"• Export data to CSV format"})]})]})}),H.jsx("div",{className:"absolute bottom-0 left-0 right-0 z-[999] bg-black/70 backdrop-blur-sm text-white text-center py-2",children:H.jsx("p",{className:"text-xs font-medium",children:"Copyright © 2025 The Mapper Co., Ltd. : Dr. Taravudh Tipdecho"})})]})};function ne(){return H.jsx("div",{className:"h-screen w-screen overflow-hidden bg-gray-900",children:H.jsx(ae,{})})}W(document.getElementById("root")).render(H.jsx(e.StrictMode,{children:H.jsx(ne,{})}));
